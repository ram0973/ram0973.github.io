{
    "version": "https://jsonfeed.org/version/1",
    "title": "IT Thoughts",
    "description": "",
    "home_page_url": "https://yabbarov.ru",
    "feed_url": "https://yabbarov.ru/feed.json",
    "user_comment": "",
    "author": {
        "name": "ram0973"
    },
    "items": [
        {
            "id": "https://yabbarov.ru/ipsec-ikev2-vpn-on-cisco-asa-5520.html",
            "url": "https://yabbarov.ru/ipsec-ikev2-vpn-on-cisco-asa-5520.html",
            "title": "IPSEC IKEV2 VPN on Cisco ASA 5520",
            "summary": "\n  <p>\n    We going to make a home lab on IPSec IKEv2 VPN on two Cisco ASA\n  </p>\n",
            "content_html": "\n  <p>\n    We going to make a home lab on IPSec IKEv2 VPN on two Cisco ASA\n  </p>\n\n\n    <h2 id=\"reset-asa-settings\">\n      Reset ASA settings\n    </h2>\n\n  <p>\n    <code>write erase</code><br>\n\n  </p>\n\n    <h2 id=\"first-asa-settings\">\n      First ASA settings\n    </h2>\n\n    <blockquote class=\"blockquote\">\n      hostname asa1\n<br>terminal width 160\n<br>domain-name yabbarov.ru\n<br>clock timezone utc 3\n<br>!\n<br>interface Ethernet 0\n<br>nameif WAN\n<br>security-level 0\n<br>ip address 192.168.0.1 255.255.255.0\n<br>no shutdown\n<br>exit\n<br>!\n<br>interface Ethernet 1\n<br>nameif LAN\n<br>security-level 100\n<br>ip address 10.16.100.1 255.255.255.0\n<br>no shutdown\n<br>exit\n<br>!\n<br>;interface Ethernet 2\n<br>; nameif DMZ\n<br>; security-level 50\n<br>; ip address 192.168.20.1 255.255.255.0\n<br>;exit\n<br>!\n<br>; Default route\n<br>route WAN 0.0.0.0 0.0.0.0 192.168.0.2 1\n<br>!\n<br>; dhcpd dns 8.8.8.8\n<br>!\n<br>; NAT for LAN\n<br>object network lan-subnet\n<br>subnet 10.16.100.0 255.255.255.0\n<br>nat (LAN,WAN) dynamic interface\n<br>exit\n<br>\n<br>; remote LAN\n<br>object network remote-lan-subnet\n<br>subnet 10.16.200.0 255.255.255.0\n<br>exit\n<br>\n<br>; NAT exemption\n<br>nat (LAN,WAN) source static lan-subnet lan-subnet destination static remote-lan-subnet remote-lan-subnet no-proxy-arp route-lookup\n<br>\n<br>; IKEV2 IPSEC TUNNEL SETTINGS\n<br>\n<br>crypto ikev2 enable WAN\n<br>\n<br>crypto ikev2 policy 20\n<br>encryption aes-256\n<br>integrity sha256\n<br>group 5\n<br>prf sha\n<br>lifetime seconds 3600\n<br>exit\n<br>!\n<br>tunnel-group 192.168.0.2 type ipsec-l2l\n<br>tunnel-group 192.168.0.2 ipsec-attributes\n<br>ikev2 remote-authentication pre-shared-key Cisco\n<br>ikev2 local-authentication pre-shared-key Cisco\n<br>\n<br>crypto ipsec ikev2 ipsec-proposal VPN-PROPOSAL\n<br>protocol esp encryption aes-256\n<br>protocol esp integrity sha-1\n<br>exit\n<br>!\n<br>access-list ASA-TO-ASA extended permit ip object lan-subnet object remote-lan-subnet\n<br>\n<br>crypto map VPN-MAP 1 match address ASA-TO-ASA\n<br>crypto map VPN-MAP 1 set peer 192.168.0.2\n<br>crypto map VPN-MAP 1 set ikev2 ipsec-proposal VPN-PROPOSAL\n<br>crypto map VPN-MAP 1 set security-association lifetime seconds 3600\n<br>crypto map VPN-MAP interface WAN\n<br>\n<br>; enable ping flow\n<br>fixup protocol icmp\n<br>\n<br>write\n<br>\n\n    </blockquote>\n\n    <h2 id=\"second-asa-settings\">\n      Second ASA settings\n    </h2>\n\n    <blockquote class=\"blockquote\">\n      hostname asa2\n<br>terminal width 160\n<br>domain-name yabbarov.ru\n<br>clock timezone utc 3\n<br>\n<br>interface Ethernet 0\n<br>nameif WAN\n<br>security-level 0\n<br>ip address 192.168.0.2 255.255.255.0\n<br>no shutdown\n<br>exit\n<br>!\n<br>interface Ethernet 1\n<br>nameif LAN\n<br>security-level 100\n<br>ip address 10.16.200.1 255.255.255.0\n<br>no shutdown\n<br>exit\n<br>!\n<br>;interface Ethernet 2\n<br>; nameif DMZ\n<br>; security-level 50\n<br>; ip address 192.168.20.1 255.255.255.0\n<br>;exit\n<br>!\n<br># маршрут по умолчанию\n<br>route WAN 0.0.0.0 0.0.0.0 192.168.0.1 1\n<br>; dhcpd dns 8.8.8.8\n<br>\n<br>; NAT for LAN\n<br>object network lan-subnet\n<br>subnet 10.16.200.0 255.255.255.0\n<br>nat (LAN,WAN) dynamic interface\n<br>exit\n<br>\n<br>; remote LAN\n<br>object network remote-lan-subnet\n<br>subnet 10.16.100.0 255.255.255.0\n<br>exit\n<br>\n<br>; NAT exemption\n<br>nat (LAN,WAN) source static lan-subnet lan-subnet destination static remote-lan-subnet remote-lan-subnet\n<br>\n<br>; IKEV2 IPSEC TUNNEL SETTINGS\n<br>\n<br>crypto ikev2 enable WAN\n<br>\n<br>crypto ikev2 policy 20\n<br>encryption aes-256\n<br>integrity sha256\n<br>group 5\n<br>prf sha\n<br>lifetime seconds 3600\n<br>exit\n<br>!\n<br>tunnel-group 192.168.0.1 type ipsec-l2l\n<br>tunnel-group 192.168.0.1 ipsec-attributes\n<br>ikev2 remote-authentication pre-shared-key Cisco\n<br>ikev2 local-authentication pre-shared-key Cisco\n<br>\n<br>crypto ipsec ikev2 ipsec-proposal VPN-PROPOSAL\n<br>protocol esp encryption aes-256\n<br>protocol esp integrity sha-1\n<br>exit\n<br>!\n<br>access-list ASA-TO-ASA extended permit ip object lan-subnet object remote-lan-subnet\n<br>!\n<br>crypto map VPN-MAP 1 match address ASA-TO-ASA\n<br>crypto map VPN-MAP 1 set peer 192.168.0.1\n<br>crypto map VPN-MAP 1 set ikev2 ipsec-proposal VPN-PROPOSAL\n<br>crypto map VPN-MAP 1 set security-association lifetime seconds 3600\n<br>crypto map VPN-MAP interface WAN\n<br>\n<br>; enable ping flow\n<br>fixup protocol icmp\n<br>\n<br>write\n<br>\n\n    </blockquote>\n\n  <p>\n    \n=============<br>CISCO 3725\n<br>\n  </p>\n\n  <p>\n    =============\n<br>\n\n  </p>\n\n  <p>\n    \n  </p>\n\n  <p>\n    hostname 3725\n<br>\n<br>; Не вылезает всякая фигня в консоли\n<br>; Отключаем исходящие Telnet соединения с маршрутизатора, они являются причиной поиска по именам доменов\n<br>ip domain lookup\n<br>line con 0\n<br>transport output none\n<br>exit\n<br>\n<br>\n<br>interface FastEthernet0/0\n<br>ip address 6.6.6.6 255.255.255.0\n<br>exit\n<br>interface FastEthernet0/1\n<br>ip address 7.7.7.7 255.255.255.0\n<br>exit\n<br>\n<br>============\n  </p>\n\n    <h2 id=\"troubleshooting-vpn\">\n      Troubleshooting VPN\n    </h2>\n\n    <h6 id=\"show-all-isakmp-and-ipsec-tunnelslessbrgreater\">\n      Show all ISAKMP and IPSEC tunnels<br>\n    </h6>\n\n  <p>\n    <code>show vpn-sessiondb</code><br>\n  </p>\n\n    <h6 id=\"show-l2l-sessions\">\n      Show L2L sessions\n    </h6>\n\n  <p>\n    <code>show vpn-sessiondb l2l</code><br>\n  </p>\n\n    <h6 id=\"how-to-end-frozen-session\">\n      How to end (frozen ?) session\n    </h6>\n\n  <p>\n    ; Как завершить (зависшую?) сессию -<br><br>; смотрим индекс предыдущей командой<br><br>; например индекс нужной сессии 1<br>; И завершаем сессию<br><br>vpn-sessiondb logoff index 1\n  </p>\n\n  <p>\n    ; packet-tracer\n<br>; packet-tracer input LAN icmp 10.16.100.2 8 0 10.16.200.2\n<br>; packet-tracer input LAN tcp 10.16.100.2 12345 8.8.8.8 80\n<br>; тут 10.16.100.1 - сама АСА - почему-то дропается\n  </p>",
            "image": "https://yabbarov.ru/media/posts/1/asa.jpg",
            "author": {
                "name": "ram0973"
            },
            "tags": [
                   "cisco"
            ],
            "date_published": "2023-04-24T10:10:23+03:00",
            "date_modified": "2023-04-24T15:51:30+03:00"
        }
    ]
}
