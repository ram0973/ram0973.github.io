<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>IPSEC IKEV2 VPN on Cisco ASA 5520 - IT Thoughts</title><meta name="description" content="; Сброс настроек - ; write erase на ASA 5520 ; packet-tracer ; packet-tracer input LAN icmp 10.16.100.2 8 0 10.16.200.2 ; packet-tracer input LAN tcp 10.16.100.2 12345 8.8.8.8 80 ; тут 10.16.100.1 - сама АСА - почему-то дропается ASA 1 ======================== hostname asa1 terminal&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://ram0973.github.io/ipsec-ikev2-vpn-on-cisco-asa-5520/"><link rel="alternate" type="application/atom+xml" href="https://ram0973.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://ram0973.github.io/feed.json"><meta property="og:title" content="IPSEC IKEV2 VPN on Cisco ASA 5520"><meta property="og:image" content="https://ram0973.github.io/media/posts/1/asa.jpg"><meta property="og:image:width" content="1600"><meta property="og:image:height" content="1200"><meta property="og:site_name" content="IT Thoughts"><meta property="og:description" content="; Сброс настроек - ; write erase на ASA 5520 ; packet-tracer ; packet-tracer input LAN icmp 10.16.100.2 8 0 10.16.200.2 ; packet-tracer input LAN tcp 10.16.100.2 12345 8.8.8.8 80 ; тут 10.16.100.1 - сама АСА - почему-то дропается ASA 1 ======================== hostname asa1 terminal&hellip;"><meta property="og:url" content="https://ram0973.github.io/ipsec-ikev2-vpn-on-cisco-asa-5520/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://ram0973.github.io/assets/css/style.css?v=ab6e9ebd4e3c4a77d09f4ac4637e7041"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ram0973.github.io/ipsec-ikev2-vpn-on-cisco-asa-5520/"},"headline":"IPSEC IKEV2 VPN on Cisco ASA 5520","datePublished":"2023-04-24T10:10","dateModified":"2023-04-24T11:20","image":{"@type":"ImageObject","url":"https://ram0973.github.io/media/posts/1/asa.jpg","height":1200,"width":1600},"description":"; Сброс настроек - ; write erase на ASA 5520 ; packet-tracer ; packet-tracer input LAN icmp 10.16.100.2 8 0 10.16.200.2 ; packet-tracer input LAN tcp 10.16.100.2 12345 8.8.8.8 80 ; тут 10.16.100.1 - сама АСА - почему-то дропается ASA 1 ======================== hostname asa1 terminal&hellip;","author":{"@type":"Person","name":"ram0973","url":"https://ram0973.github.io/authors/ram0973/"},"publisher":{"@type":"Organization","name":"ram0973"}}</script><noscript><style>img[loading] {
					opacity: 1;
				}</style></noscript></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://ram0973.github.io/">IT Thoughts</a></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2023-04-24T11:21">April 24, 2023</time></div></div><main class="main"><article class="post"><figure class="post__featured-image"><img src="https://ram0973.github.io/media/posts/1/asa.jpg" srcset="https://ram0973.github.io/media/posts/1/responsive/asa-xs.webp 300w, https://ram0973.github.io/media/posts/1/responsive/asa-sm.webp 480w, https://ram0973.github.io/media/posts/1/responsive/asa-md.webp 768w, https://ram0973.github.io/media/posts/1/responsive/asa-lg.webp 1024w, https://ram0973.github.io/media/posts/1/responsive/asa-xl.webp 1360w, https://ram0973.github.io/media/posts/1/responsive/asa-2xl.webp 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1200" width="1600" alt=""></figure><header class="u-header post__header"><h1>IPSEC IKEV2 VPN on Cisco ASA 5520</h1><div class="u-header__meta u-small"><div><a href="https://ram0973.github.io/authors/ram0973/" title="ram0973">ram0973</a> <time datetime="2023-04-24T10:10">April 24, 2023 </time><a href="https://ram0973.github.io/tags/cisco/" class="u-tag u-tag--1">cisco</a></div></div></header><div class="post__entry u-inner"><p>; Сброс настроек -<br>; write erase на ASA 5520<br><br>; packet-tracer<br>; packet-tracer input LAN icmp 10.16.100.2 8 0 10.16.200.2<br>; packet-tracer input LAN tcp 10.16.100.2 12345 8.8.8.8 80<br>; тут 10.16.100.1 - сама АСА - почему-то дропается<br><br>ASA 1<br>========================<br><br><code>hostname asa1<br>terminal width 160<br>domain-name yabbarov.ru<br>clock timezone utc 3<br>!<br>interface Ethernet 0<br>nameif WAN<br>security-level 0<br>ip address 192.168.0.1 255.255.255.0<br>no shutdown<br>exit<br>!<br>interface Ethernet 1<br>nameif LAN<br>security-level 100<br>ip address 10.16.100.1 255.255.255.0<br>no shutdown<br>exit<br>!<br>;interface Ethernet 2<br>; nameif DMZ<br>; security-level 50<br>; ip address 192.168.20.1 255.255.255.0<br>;exit<br>!<br>; Default route<br>route WAN 0.0.0.0 0.0.0.0 192.168.0.2 1<br>!<br>; dhcpd dns 8.8.8.8<br>!<br>; NAT for LAN<br>object network lan-subnet<br>subnet 10.16.100.0 255.255.255.0<br>nat (LAN,WAN) dynamic interface<br>exit<br><br>; remote LAN<br>object network remote-lan-subnet<br>subnet 10.16.200.0 255.255.255.0<br>exit<br><br>; NAT exemption<br>nat (LAN,WAN) source static lan-subnet lan-subnet destination static remote-lan-subnet remote-lan-subnet no-proxy-arp route-lookup<br><br>; IKEV2 IPSEC TUNNEL SETTINGS<br><br>crypto ikev2 enable WAN<br><br>crypto ikev2 policy 20<br>encryption aes-256<br>integrity sha256<br>group 5<br>prf sha<br>lifetime seconds 3600<br>exit<br>!<br>tunnel-group 192.168.0.2 type ipsec-l2l<br>tunnel-group 192.168.0.2 ipsec-attributes<br>ikev2 remote-authentication pre-shared-key Cisco<br>ikev2 local-authentication pre-shared-key Cisco<br><br>crypto ipsec ikev2 ipsec-proposal VPN-PROPOSAL<br>protocol esp encryption aes-256<br>protocol esp integrity sha-1<br>exit<br>!<br>access-list ASA-TO-ASA extended permit ip object lan-subnet object remote-lan-subnet<br><br>crypto map VPN-MAP 1 match address ASA-TO-ASA<br>crypto map VPN-MAP 1 set peer 192.168.0.2<br>crypto map VPN-MAP 1 set ikev2 ipsec-proposal VPN-PROPOSAL<br>crypto map VPN-MAP 1 set security-association lifetime seconds 3600<br>crypto map VPN-MAP interface WAN<br><br>; enable ping flow<br>fixup protocol icmp<br><br>write</code><br><br>ASA 2<br>=================<br><br><code>hostname asa2<br>terminal width 160<br>domain-name yabbarov.ru<br>clock timezone utc 3<br><br>interface Ethernet 0<br>nameif WAN<br>security-level 0<br>ip address 192.168.0.2 255.255.255.0<br>no shutdown<br>exit<br>!<br>interface Ethernet 1<br>nameif LAN<br>security-level 100<br>ip address 10.16.200.1 255.255.255.0<br>no shutdown<br>exit<br>!<br>;interface Ethernet 2<br>; nameif DMZ<br>; security-level 50<br>; ip address 192.168.20.1 255.255.255.0<br>;exit<br>!<br># маршрут по умолчанию<br>route WAN 0.0.0.0 0.0.0.0 192.168.0.1 1<br>; dhcpd dns 8.8.8.8<br><br>; NAT for LAN<br>object network lan-subnet<br>subnet 10.16.200.0 255.255.255.0<br>nat (LAN,WAN) dynamic interface<br>exit<br><br>; remote LAN<br>object network remote-lan-subnet<br>subnet 10.16.100.0 255.255.255.0<br>exit<br><br>; NAT exemption<br>nat (LAN,WAN) source static lan-subnet lan-subnet destination static remote-lan-subnet remote-lan-subnet<br><br>; IKEV2 IPSEC TUNNEL SETTINGS<br><br>crypto ikev2 enable WAN<br><br>crypto ikev2 policy 20<br>encryption aes-256<br>integrity sha256<br>group 5<br>prf sha<br>lifetime seconds 3600<br>exit<br>!<br>tunnel-group 192.168.0.1 type ipsec-l2l<br>tunnel-group 192.168.0.1 ipsec-attributes<br>ikev2 remote-authentication pre-shared-key Cisco<br>ikev2 local-authentication pre-shared-key Cisco<br><br>crypto ipsec ikev2 ipsec-proposal VPN-PROPOSAL<br>protocol esp encryption aes-256<br>protocol esp integrity sha-1<br>exit<br>!<br>access-list ASA-TO-ASA extended permit ip object lan-subnet object remote-lan-subnet<br>!<br>crypto map VPN-MAP 1 match address ASA-TO-ASA<br>crypto map VPN-MAP 1 set peer 192.168.0.1<br>crypto map VPN-MAP 1 set ikev2 ipsec-proposal VPN-PROPOSAL<br>crypto map VPN-MAP 1 set security-association lifetime seconds 3600<br>crypto map VPN-MAP interface WAN<br><br>; enable ping flow<br>fixup protocol icmp<br><br>write</code><br><br><br>CISCO 3725<br>=============<br><br>hostname 3725<br><br>; Не вылезает всякая фигня в консоли<br>; Отключаем исходящие Telnet соединения с маршрутизатора, они являются причиной поиска по именам доменов<br>ip domain lookup<br>line con 0<br>transport output none<br>exit<br><br><br>interface FastEthernet0/0<br>ip address 6.6.6.6 255.255.255.0<br>exit<br>interface FastEthernet0/1<br>ip address 7.7.7.7 255.255.255.0<br>exit<br><br>============<br>; Отобразить все ISAKMP и IPSEC туннели<br>show vpn-sessiondb<br><br>; Отобразить сессии<br>show vpn-sessiondb l2l<br><br>; Как завершить (зависшую?) сессию -<br>; смотрим индекс предыдущей командой<br>; например индекс нужной сессии 2<br>; И завершаем сессию<br>vpn-sessiondb logoff index 2<br><br><br>This article was updated on April 24, 2023<br><br>cisco<br>ram0973<br>POWERED BY PUBLII</p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on April 24, 2023</div><div class="post__share"></div></aside><footer class="post__footer"><div class="post__bio box"><div><h4 class="h6"><a href="https://ram0973.github.io/authors/ram0973/" title="ram0973">ram0973</a></h4></div></div></footer></article></main><div class="sidebar"><section class="box authors"><h3 class="box__title">Authors</h3><ul class="authors__cotainer"><li class="authors__item"><div><a href="https://ram0973.github.io/authors/ram0973/" class="authors__title">ram0973</a> <span class="u-small">Post: 1</span></div></li></ul></section><section class="newsletter box box--gray"><h3 class="box__title">Newsletter</h3><p class="newsletter__description">Sign up to receive email updates and to hear what's going on with us!</p><form>...</form></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://ram0973.github.io/tags/cisco/">cisco</a> <span class="u-small">(1)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://ram0973.github.io/">IT Thoughts</a><nav><ul class="footer__nav"></ul></nav><div class="footer__copyright">Powered by Publii</div></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://ram0973.github.io/assets/js/scripts.min.js?v=ef33954c8f912e6c18ee116825aadc90"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>